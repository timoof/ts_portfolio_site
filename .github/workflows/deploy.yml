name: Deploy to FTP

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Deploy to FTP Server
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Remove old /domains folder from FTP
        run: |
          sudo apt-get install -y lftp
          lftp -e "
            set ftp:passive-mode true;
            rm -rf /domains;
            bye;
          " -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_HOST }}
        continue-on-error: true

      - name: Deploy to FTP (passive mode)
        run: |
          sudo apt-get install -y lftp
          lftp -e "
            set ftp:passive-mode true;
            mirror --reverse --delete --verbose --parallel=5 \
              --exclude-glob .git* \
              --exclude-glob node_modules/ \
              --exclude-glob uploads/ \
              --exclude-glob .gitignore \
              ./ /public_html/;
            bye;
          " -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_HOST }}
